
\chapter{Metody vizualizace a porovnání} \label{porovnani}

Cílem této knihovny není pouze vizualizovat sekundární strukturu RNA, ale také
usnadnit analýzu rozdílů a podobností mezi více strukturami RNA. Proto jsme se
zaměřili na práci s radial diagramy, které nejlépe zobrazuji motivy struktury
a zároveň jsou nejpřirozenější reprezentací jak pro biology, kteří jsou zvyklí
s takovým diagramem pracovat, tak pro širší veřejnost.

Pro generování radial diagramů používají nástroje pro vizualizaci\ref{projekty}
různé algoritmy. Nás zaujala možnost generování za použití vzorové struktury,
jako to dělá nástroj Traveler. Výstupem Traveleru je soubor ve formátu JSON,
který obsahuje informace o vzoru každého nukleotidu a provedených úpravách -
přidání, odebrání, přejmenování a přesunutí nukleotidu.

Například pokud bychom použili nástroj Varna na zobrazení dvou struktur jako na
obrázku\ref{dvestruktury}, musíme všechny podobnosti vypozorovat sami. Některé
motivy sice není složité vypozorovat, ale není na první pohled jasná podobnost
sekvence.

\begin{figure}[H]
  \centering
  \includegraphics[width=140mm]{../img/kap02/intro/varna.png}
  \caption[Dvě sekundární RNA struktury]{Dvě sekundární RNA struktury s
  RNAcentral ID A) URS00006E712C, B) URS0000AB09C9.}
  \label{dvestruktury}
\end{figure}

Na generování obou struktur používá nástroj Traveler stejnou vzorovou
strukturu, která je v tomto konkrétním případě podobná obou odvozeným
strukturám. Podobnost odvozených struktur ke vzorové je až na výjimky běžná, a
proto jsme se rozhodli tuto podobnost předpokládat. Obrázek \ref{bla} je
vizualizace stejných struktur, za použití nástroje Traveler spolu se vzorovou
strukturou.

\begin{figure}[H]
  \centering
  \includegraphics[width=140mm]{../img/kap02/intro/alignMotivationTemplate.png}
  \caption[Dvě odvozené sekundární struktury a jedna vzorová]{Tři sekundární
  RNA struktury s RNAcentral ID A) URS00006E712C, B) URS0000AB09C9 vygenerované
  nástrojem Traveler pomocí C) vzorové sekundární RNA struktury
  d.5.e.S.oshimae.}
  \label{bla}
\end{figure}

Přidáním struktury, ze které jsou obě struktury odvozené, je mnohem jasnější,
na která místa koukat pří hledání podobností a rozdílů. Přesto nemusí být
nějaká podobnost hned jasná, a proto jsme se zaměřili na způsoby, jak znázornit
mapování nukleotidů na vzorovou strukturu.

\section{Důsledek využívaní vzorové struktury}

Využívání vzorové struktury pro analýzu má důležitý důsledek. Nástroj
implementovaný v rámci této bakalářské práce usnadňuje analýzu $N$ struktur,
které byly vygenerované ze stejné vzorové struktury. 

Nástroj Traveler umožňuje zvolit vzorovou strukturu, pomocí které se bude
generovat rozložení. Pokud použijeme vzorovou strukturu, která není dostatečně
podobná, bude i vygenerované rozložení velmi odlišné a nebude existovat mnoho
nukleotidů, které půjde namapovat na vzorové nukleotidy. Z těchto důvodu lze
teoreticky knihovnu, kterou představujeme v této práci použít na porovnávání
jakýchkoliv struktur, protože si můžeme vynutit generování na základě stejné
vzorové struktury, ale představené metody, které předpokládají podobnost
nebudou užitečné. 

\section{Překládání struktur}

Vygenerované sekundární struktury jsou podobné vzorové struktuře\ref{blabla}, a
tím pádem bývají podobné i ostatním vygenerovaným strukturám ze stejné vzorové
struktury. Dává proto smysl se pokusit struktury přes sebe přeložit\ref{over},
aby se spojily společné části a vynikly rozdíly. Pouhým přeložením podobných
struktur přes sebe však získáme výsledek, který neposkytuje příliš zajímavé
informace a je málo přehledný.

\begin{figure}[H]
  \centering
  \includegraphics[width=140mm]{../img/kap02/align/structures.png}
  \caption[Vygenerovaná struktura vedle se vzorovou]{A) Struktura s RNAcentral
  ID URS00000B9D9D vygenerovaná nástrojem Traveler pomocí B) vzorové struktury
  d.5.b.A.madurae vedle sebe.}
  \label{blabla}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[height=90mm]{../img/kap02/align/unaligned.png}
  \caption[Vygenerovaná a vzorová struktura vykreslené přes sebe]{A) Struktura
  s RNAcentral ID URS00000B9D9D vygenerovaná nástrojem Traveler pomocí B)
  vzorové struktury d.5.b.A.madurae přeložené přes sebe.}
  \label{over}
\end{figure}

\subsection{Zarovnání} \label{zarovnani}

Je potřeba najít způsob, jak řešit problém přesunu a zarovnání struktury,
protože manuální manipulace pomocí přetažení myší nebo zadávání pozice může být
zbytečně obtížná, zejména pokud se snažíme dosáhnout přesného zarovnání. Proto
je velmi užitečné umožnit zarovnání sekundární RNA struktury na konkrétní
nukleotid nebo skupinu nukleotidů ze vzorové struktury. 

Pokud je vybrán vzorový nukleotid $v$ pro nukleotid $n$ z ostatních struktur,
jehož vzor je $v$, je celá struktura přesunuta tak, aby se nukleotidy $v$ a $n$
překrývaly. 

\subsubsection{Skupiny nukleotidů}

Pokud se snažíme najít větší skupinu nukleotidů, na které chceme strukturu
zarovnat, koukáme se na posunutí pro konkrétní nukleotidy a následně vybereme
buď posunutí které zarovná nejvíc nukleotidů nebo to které zarovná skupinu
nukleotidů které jsou v části struktury, která nás právě zajímá.

Pro hledání konkrétního posunutí pro zarovnání jsme použili naivní způsob,
který nezaručuje nejlepší možné zarovnání, ale zároveň je poměrně přímočarý a
dává rozumné výsledky, díky již zmíněné podobnosti struktur.

Postupně se prochází každá struktura. V první iteraci se porovná pozice každého
nukleotidu s pozicí ve vzorové struktuře. Na základě pozice se roztřídí
nukleotidy. Třídění funguje tak, že do stejné skupiny indexované posunutím se
přidají všechny vzorové nukleotidy, na které se struktura zarovná daným posunutím.

V druhé iteraci se postupuje podobně, ale používají se poslední vytvořené
skupiny na filtrování, tím se snažíme docílit, zarovnání na stejné nukleotidy.
Filtrování pomocí skupin ignoruje všechny nukleotidy, jejiž vzor není v nějaké
skupině, pomocí které filtrujeme. Pokud během iterace nevzniknou žádné skupiny,
řeší se iterace daná iterace zvlášť bez filtrování.

Zarovnání je popsáno pseudokódem \ref{pseudo}, který vybírá z vytvořených
skupin vždy to nejlepší zarovnání. Výsledek takového zarovnání je vidět na
obrázku \ref{zarovnani}.

\begin{lstlisting}[caption={Pseudokód zarovnání struktur},label=pseudo]
def createGroup(residues, filterGroup):
  group je tabulka polí nukleotidů indexovaná souřadnicema
  group = prázdná tabulka 
  for residue in residues:
    if (residue má vzorový nukleotid 
    and (filterGroup is null 
      or vzorový nukleotid residue je ve filterGroup)):
      t = posunutí residue, aby byl na stejné pozici,
          jako je jeho vzorový nukleotid
      přidat residue na konec pole v tabulce tempGroup 
      s indexem t
    }
  return group

structures = pole struktur odvozených od stejné 
             vzorové struktury
filterGroup je tabulka polí nukleotidů indexovaná 
souřadnicema
filterGroup = null

for structure in structures:
  residues = pole nukleotidů struktury structure
  group = createGroup(residues, filterGroup)
  if (group je prázdná):
    group = createGroup(residues, null)
  if (group není prázdná):
    bestShift = index (posunutí) z tabulky group, který má 
                nejdelší pole
    posuneme strukturu structure o bestShift
    filterGroup = tempGroup
  tempGroup = prázdná tabulka
\end{lstlisting}

\begin{figure}[H]
  \centering
  \includegraphics[height=90mm]{../img/kap02/align/alignedAlpha1.png}
  \caption[Vygenerovaná a vzorová struktura vykreslené přes sebe]{A) Struktura
  s RNAcentral ID URS00000B9D9D vygenerovaná nástrojem Traveler pomocí B)
  vzorové struktury d.5.b.A.madurae přeložené přes sebe a zarovnané.}
  \label{zarovnani}
\end{figure}

\subsection{Průhlednost struktur}

V přeložených a zarovnaných strukturách nelze snadno rozeznat, které nukleotidy
jsou společné a překrývají se a které nejsou. Přidáním průhlednosti je možné
tuto situaci rozlišit, protože překrývající se nukleotidy budou mít sytější
barvu než ty, které se nepřekrývají\ref{alpha}.

\begin{figure}[H]
  \centering
  \includegraphics[height=90mm]{../img/kap02/align/aligned.png}
  \caption[Vygenerovaná a vzorová struktura vykreslené přes sebe]{A) Struktura
  s RNAcentral ID URS00000B9D9D vygenerovaná nástrojem Traveler pomocí B)
  vzorové struktury d.5.b.A.madurae přeložené přes sebe, zarovnané a s
  průhledností.}
  \label{alpha}
\end{figure}

\subsection{Rozmazání struktur}

Zarovnávání struktur bohužel neřeší všechny výzvy. Výsledné obrázky se mohou
zdát rozmazané. To je způsobeno tím, že ačkoli má nukleotid vzorový nukleotid,
který je stejný, jeho pozice se může v rozložení mírně lišit v důsledku metody
generování dat. Tento fakt může způsobit, že popisky nukleotidů vypadají
rozmazaně.

Jako přímočaré řešení se může zdát posunutí jednotlivých nukleotidů, které jsou
blízko sebe, aby dokonale překrývaly jejich vzory. Věříme, že by to vyřešilo
zmíněný problém bez významné deformace struktury.

\section{Obarvení struktur}

Vstupní data obsahují barevné označení nukleotidů\ref{coloring}. Slouží k
lepšímu zorientování se ve struktuře vzhledem ke vzorové struktuře. Jejich
význam je následující.

Černá barva značí, že nukleotid leží na poloze vzorového nukleotidu se stejným
názvem. Zelenou barvou jsou označený ty nukleotidy jejíž vzorový nukleotid bylo
třeba přejmenovat. Modrou barvou jsou vyznačený posunutý nukleotid. A poslední
růžovou barvu mají nově přidané nukleotidy.

\begin{figure}[H]
  \centering
  \includegraphics[width=140mm]{../img/kap03/inputDataColors.png}
  \caption[Vygenerovaná struktura vedle se vzorovou]{A) Struktura s RNAcentral
  ID URS00000B9D9D vygenerovaná nástrojem Traveler pomocí B) vzorové struktury
  d.5.b.A.madurae.}
  \label{coloring}
\end{figure}

\section{Transformace na vzor}

Užitečnou metodou je animovaná transformace mezi vzorovou a cílovou
strukturou\ref{transformation}. Každý nukleotid, který má svůj vzorový
nukleotid, se přemístí na pozici vzorového nukleotidu a nukleotidy, které ve
vzoru nejsou, jsou skryté. Tato metoda je velmi užitečná pro práci s dvěma
strukturami, které jsou si podobné, nebo pro získání počátečního přehledu o
tom, co je na co namapováno. 

Slabou stránkou této metody je její použití při práci s více než dvěma
strukturami nebo strukturami, které jsou velmi odlišné. V takových situacích se
na obrazovce děje mnoho věcí a je obtížné se soustředit a vypozorovat něco
užitečného.

\begin{figure}[H]
  \centering
  \includegraphics[width=140mm]{../img/kap02/animation.png}
  \caption[Před a po transformaci vygenerované struktury na vzorovou]{Struktura
  s RNAcentral ID URS00000B9D9D vygenerovaná nástrojem Traveler pomocí vzorové
  struktury d.5.b.A.madurae přeložené přes sebe A) před transformací a B) po
  transformaci.}
  \label{transformation}
\end{figure}

\section{Mapovací čáry}

Vědomost o tom, který nukleotid se na co mapuje, může být důležitá pro odhalení
rozdílů a podobností mezi strukturami. V našem úsilí zprostředkovat tuto
informaci již před transformací na vzorovou sturkturu jsme přišli s metodou,
která spojuje každý nukleotid s jeho vzorovým nukleotidem čárou\ref{lines}.

\begin{figure}[H]
  \centering
  \includegraphics[height=80mm]{../img/kap02/mappingLines/small.png}
  \caption[Ukázka mapovacích čar]{Struktura s RNAcentral ID URS00000B9D9D
  vygenerovaná nástrojem Traveler pomocí vzorové struktury d.5.b.A.madurae
  přeložené přes sebe s mapovacíma čárami.}
  \label{lines}
\end{figure}

Bohužel tento způsob se zvětšující se velikostí struktury stává velmi
nepřehledným\ref{uglylines}, přesto si myslíme že můžou být užitečné.

\begin{figure}[H]
  \centering
  \includegraphics[height=100mm]{../img/kap02/mappingLines/big.png}
  \caption[Ukázka mapovacích čar]{Výřez z mnoha struktur vygenerovaných nástrojem Traveler pomocí vzorové struktury DD\_28S\_3D přeložených přes sebe s mapovacími čárami.
  Každá struktura má vlastní barvu mapovacích čar.}
  \label{uglylines}
\end{figure}

\section{Využití stromu}

V projektu Traveler byla použita stromová reprezentace pro sekundární RNA
strukturu, ve které je vnitřní vrchol, tedy má více jak jednu hranu, bázový pár
a listem, tedy má jednu nebo žádnou hranu, je nespárovaný nukleotid. Strom pak
lze vytvořit následovně. První nepárové nukleotidy ze začátku a z konce přidáme
jako samostatné vrcholy. Potom jdeme postupně po bázových párech. První bázový
pár tvoří kořen. Další bázové páry připojujeme a tvoříme strom. Pokud narazíme
na nespárovaný nukleotid přidáme ho jako list k poslednímu přidanému bázovému
páru. Větvení struktury vyústí ve větvení stromu. V obrázku \ref{treerep} je
ukázka radial diagramu sekundární struktury RNA spolu s její stromovu
reprezentací.

\begin{figure}[H]
  \centering
  \includegraphics[width=130mm]{../img/kap02/tree/tree.png}
  \caption[Stromová reprezentace sekundární struktury RNA]{Vlevo je uměle
  vytvořená struktura zobrazená nástrojem Varna. Vpravo je jeho stromová
  reprezentace.}
  \label{treerep}
\end{figure}

Stromovu strukturu jsme neměli v úmyslu použít na nic konkrétního, ale chtěli
jsme prozkoumat možnosti lokálních transformací struktury pro dosažení
zarovnání více podobných částí, které jsou třeba jenom posunuté, jako je to
například vidět na obrázku \ref{firstalign} a \ref{secondalign}. Obrázky jsou
výřezy dvou struktu, které jsou zarovnané dvěma způsoby.

\begin{figure}[H]
  \centering
  \includegraphics[height=100mm]{../img/kap02/tree/align1.png}
  \caption[První způsob zarovnání]{První způsob zarovnání.}
  \label{firstalign}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[height=100mm]{../img/kap02/tree/align2.png}
  \caption[Druhý způsob zarovnání]{Druhý způsob zarovnání.}
  \label{secondalign}
\end{figure}

Po zvážení jsme dospěli k názoru, že není možné provést úpravu struktury, která
by významně nedeformovala strukturu. Jakákoli úprava části struktury znamená
posunutí nějakého zbytku struktury, což může zasáhnout do jiné části. Proto by
bylo nezbytné odebrat některé nukleotidy. Ty, které nejvíce překážejí, jsou ty
přidané. Pokud bychom odebrali tyto přidané nukleotidy, dostali bychom se na
stejný výsledek jako s transformací struktury na vzorovou strukturu.

\section{Zvolené metody}

Naše knihovna přímo podporuje překládání a zarovnání struktur na konkrétní
nukleotid nebo skupinu nukleotidů bez zarovnání na úrovni jednotlivých
nukleotidů pro odstranění rozmazání struktur. Lze transformovat struktury na
vzorovou strukturu a upravovat průhlednost struktur.
